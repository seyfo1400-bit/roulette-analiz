import streamlit as st
import pandas as pd
from collections import Counter

st.set_page_config(page_title="Roulette Analiz ve Tahmin", layout="wide")
st.title("ğŸ² Profesyonel Roulette Analiz ve Tahmin")

# ---------- SayÄ±larÄ± Al ----------
numbers_input = st.text_area("SayÄ±larÄ± gir (virgÃ¼lle, alt alta veya boÅŸlukla ayÄ±rabilirsin):")

# ---------- Renk ve BÃ¶lge Verileri ----------
red_numbers = {1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36}
black_numbers = {2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35}

# BÃ¶lge: 1-12, 13-24, 25-36
def get_zone(n):
    if n == 0:
        return "0"
    elif 1 <= n <= 12:
        return "1. BÃ¶lge"
    elif 13 <= n <= 24:
        return "2. BÃ¶lge"
    elif 25 <= n <= 36:
        return "3. BÃ¶lge"
    else:
        return "Bilinmiyor"

def get_color(n):
    if n == 0: return "ğŸŸ¢ YeÅŸil"
    elif n in red_numbers: return "ğŸ”´ KÄ±rmÄ±zÄ±"
    elif n in black_numbers: return "âš« Siyah"
    else: return "â“"

# ---------- Veri Ä°ÅŸleme ----------
if numbers_input:
    # SayÄ±larÄ± temizle
    numbers = [int(x) for x in numbers_input.replace("\n", ",").replace(" ", "").split(",") if x.strip().isdigit()]
    df = pd.DataFrame(numbers, columns=["SayÄ±"])
    df["Renk"] = df["SayÄ±"].apply(get_color)
    df["BÃ¶lge"] = df["SayÄ±"].apply(get_zone)

    # ---------- Son 20 SayÄ± ----------
    st.subheader("ğŸ“Œ Son Girilen 20 SayÄ±")
    st.write(df.tail(20))

    # ---------- Genel Ä°statistik ----------
    st.subheader("ğŸ“Š Genel Ä°statistikler")
    color_counts = df["Renk"].value_counts().reindex(["ğŸ”´ KÄ±rmÄ±zÄ±", "âš« Siyah", "ğŸŸ¢ YeÅŸil"]).fillna(0).astype(int)
    zone_counts = df["BÃ¶lge"].value_counts().reindex(["1. BÃ¶lge","2. BÃ¶lge","3. BÃ¶lge","0"]).fillna(0).astype(int)
    st.table(pd.DataFrame({"Renk": color_counts.index, "Adet": color_counts.values}))
    st.table(pd.DataFrame({"BÃ¶lge": zone_counts.index, "Adet": zone_counts.values}))

    # ---------- En Ã‡ok Gelen 3 SayÄ± ----------
    top_numbers = df["SayÄ±"].value_counts().head(3)
    st.subheader("ğŸ¯ En YÃ¼ksek OlasÄ±lÄ±klÄ± 3 SayÄ±")
    top_df = pd.DataFrame({
        "SayÄ±": top_numbers.index,
        "GeliÅŸ SayÄ±sÄ±": top_numbers.values,
        "Renk": [get_color(n) for n in top_numbers.index],
        "BÃ¶lge": [get_zone(n) for n in top_numbers.index]
    })
    st.table(top_df)

    # ---------- Belirli SayÄ±nÄ±n ArdÄ±ndan Gelenler ----------
    selected_number = st.number_input("Bir sayÄ± seÃ§ (hangi sayÄ±nÄ±n ardÄ±ndan ne gelmiÅŸ gÃ¶rmek iÃ§in):", 0, 36, 0)
    following = [numbers[i+1] for i in range(len(numbers)-1) if numbers[i] == selected_number]

    if following:
        st.subheader(f"ğŸ” {selected_number} sayÄ±sÄ±ndan sonra gelen sayÄ±lar")
        follow_counts = pd.Series(following).value_counts().reset_index()
        follow_counts.columns = ["SayÄ±", "GeliÅŸ SayÄ±sÄ±"]
        follow_counts["Renk"] = follow_counts["SayÄ±"].apply(get_color)
        follow_counts["BÃ¶lge"] = follow_counts["SayÄ±"].apply(get_zone)
        st.table(follow_counts)
        st.bar_chart(follow_counts.set_index("SayÄ±")["GeliÅŸ SayÄ±sÄ±"])
    else:
        st.info("Bu sayÄ± hiÃ§ gelmemiÅŸ veya ardÄ±ndan baÅŸka sayÄ± yok.")

    # ---------- Tahmin (Basit OlasÄ±lÄ±k) ----------
    st.subheader("ğŸ§  Tahmin: Son sayÄ± dizisine gÃ¶re olasÄ± 3 sayÄ±")
    if numbers:
        last_number = numbers[-1]
        next_numbers = [numbers[i+1] for i in range(len(numbers)-1) if numbers[i]==last_number]
        if next_numbers:
            counter = Counter(next_numbers)
            most_common = counter.most_common(3)
        else:
            most_common = [(n,0) for n in range(1,4)]  # EÄŸer veri yoksa rastgele placeholder
        predict_df = pd.DataFrame({
            "Tahmin SayÄ±sÄ±": [n[0] for n in most_common],
            "Tahmin SÄ±klÄ±ÄŸÄ±": [n[1] for n in most_common],
            "Renk": [get_color(n[0]) for n in most_common],
            "BÃ¶lge": [get_zone(n[0]) for n in most_common]
        })
        st.table(predict_df)
    else:
        st.info("Tahmin iÃ§in yeterli veri yok.")
else:
    st.info("LÃ¼tfen en az 1 sayÄ± gir.")
